"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[836],{2836:(te,H,r)=>{r.r(H),r.d(H,{PaymentModule:()=>jt});var z=r(4521),K=r(5861),V=r(655),d=r(3075),f=r(1937),x=r(7579),m=r(2722),h=r(8966),t=r(5e3),J=r(7495),X=r(1135),b=r(4004),y=r(262),Z=r(9646),W=r(2340),tt=r(520);const v=W.N.base_url;let D=(()=>{class i{constructor(e){this._http=e,this.userId=new x.x,this.onlistenSubject=new x.x,this._payments=new X.X(null)}get userId$(){return this.userId.asObservable()}get payments$(){return this._payments.asObservable()}getPayments(e){return this._http.post(`${v}/payment/payments`,e,this.getHeaders).pipe((0,b.U)(n=>n.statusCode&&200==n.statusCode?(this._payments.next(n.data),{payments:n.data,total:n.count,page:n.page,pages:n.pages}):null),(0,y.K)(n=>(0,Z.of)(null)))}createPayment(e){return this._http.post(`${v}/payment/create`,e,this.getHeaders).pipe((0,b.U)(n=>({statusCode:(null==n?void 0:n.statusCode)||500,filename:null==n?void 0:n.recipe})),(0,y.K)(n=>(0,Z.of)({statusCode:n.status,filename:""})))}approvePayment(e){return this._http.put(`${v}/payment/approve`,e,this.getHeaders).pipe((0,b.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,y.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}denyPayment(e){return this._http.put(`${v}/payment/deny`,e,this.getHeaders).pipe((0,b.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,y.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}cancelPayment(e){return this._http.put(`${v}/payment/cancel`,e,this.getHeaders).pipe((0,b.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,y.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}getMonths(){const n=(new Date).getMonth()+1;return[{description:"Enero",value:1},{description:"Febrero",value:2},{description:"Marzo",value:3},{description:"Abril",value:4},{description:"Mayo",value:5},{description:"Junio",value:6},{description:"Julio",value:7},{description:"Agosto",value:8},{description:"Septiembre",value:9},{description:"Octubre",value:10},{description:"Noviembre",value:11},{description:"Diciembre",value:12}].slice(0,n)}download(e){return this._http.get(`${v.replace("/api","")}/uploads/${e}`,{responseType:"blob"})}getAmounts(){return[{description:"Q 800.00",value:800}]}get getToken(){return localStorage.getItem("x-token")||""}get getHeaders(){return{headers:{"x-token":this.getToken}}}listenDialog(){this.onlistenSubject.next()}get dialogStatus(){return this.onlistenSubject.asObservable()}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(tt.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var U=r(7550),g=r(9808),T=r(7322),E=r(7531),Q=r(4102),w=r(508),A=r(5245),P=r(7423);function et(i,a){if(1&i&&(t.TgZ(0,"strong",18),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.hij("Cliente: ",null==e.user?null:e.user.DisplayName,"")}}function nt(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function it(i,a){if(1&i&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.Name)}}function ot(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function at(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function st(i,a){if(1&i&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.description)}}function rt(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function lt(i,a){if(1&i&&t._UZ(0,"img",20),2&i){const e=t.oxw(2);t.Q6J("src",e.base64Image,t.LSH)}}function ct(i,a){1&i&&(t.TgZ(0,"div",21),t._UZ(1,"mat-icon",22),t.TgZ(2,"div",23),t._uU(3,"PDF"),t.qZA()()),2&i&&(t.xp6(1),t.Q6J("svgIcon","iconsmind:file"))}function ut(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1,"La im\xe1gen debe ser en extensi\xf3n .jpg, .png o .jpeg"),t.qZA())}function mt(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1,"La im\xe1gen debe pesar menos o igual a 7mb"),t.qZA())}function dt(i,a){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"h1",1),t._uU(2,"Realizar pago"),t.qZA(),t.YNc(3,et,2,1,"strong",2),t.TgZ(4,"form",3),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw().registerPayment()}),t.TgZ(5,"mat-form-field"),t._UZ(6,"input",4),t.YNc(7,nt,2,0,"mat-error",0),t.qZA(),t.TgZ(8,"mat-form-field")(9,"mat-select",5),t.NdJ("selectionChange",function(o){return t.CHM(e),t.oxw().onOptionSelection(o)}),t.YNc(10,it,2,2,"mat-option",6),t.qZA(),t.YNc(11,ot,2,0,"mat-error",0),t.qZA(),t.TgZ(12,"mat-form-field"),t._UZ(13,"input",7),t.YNc(14,at,2,0,"mat-error",0),t.qZA(),t.TgZ(15,"mat-form-field")(16,"mat-select",8),t.YNc(17,st,2,2,"mat-option",6),t.qZA(),t.YNc(18,rt,2,0,"mat-error",0),t.qZA(),t.TgZ(19,"div",9)(20,"div",10),t.YNc(21,lt,1,1,"img",11),t.YNc(22,ct,4,1,"div",12),t.qZA()(),t.TgZ(23,"div",13)(24,"input",14),t.NdJ("change",function(o){return t.CHM(e),t.oxw().onFileSelected(o)}),t.qZA(),t.YNc(25,ut,2,0,"mat-error",0),t.YNc(26,mt,2,0,"mat-error",0),t.qZA(),t.TgZ(27,"div",15)(28,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClose()}),t._uU(29," Cancelar "),t.qZA(),t.TgZ(30,"button",17),t._uU(31," Crear "),t.qZA()()(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",null==e.data?null:e.data.user),t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("ngIf",e.form.get("description").invalid&&e.form.get("description").touched),t.xp6(3),t.Q6J("ngForOf",e.services),t.xp6(1),t.Q6J("ngIf",e.form.get("serviceId").invalid&&e.form.get("serviceId").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("amount").invalid&&e.form.get("amount").touched),t.xp6(3),t.Q6J("ngForOf",e.months),t.xp6(1),t.Q6J("ngIf",e.form.get("month").invalid&&e.form.get("month").touched),t.xp6(3),t.Q6J("ngIf",e.base64Image),t.xp6(1),t.Q6J("ngIf",!e.base64Image),t.xp6(3),t.Q6J("ngIf",e.invalidExtention),t.xp6(1),t.Q6J("ngIf",e.invalidSize),t.xp6(4),t.Q6J("color","primary")("disabled",e.form.invalid||e.form.pristine&&e.noImageChanged||e.invalidExtention||e.invalidSize)}}function pt(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function gt(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function _t(i,a){if(1&i&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.description)}}function ht(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function ft(i,a){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function vt(i,a){if(1&i&&t._UZ(0,"img",20),2&i){const e=t.oxw(2);t.Q6J("src",e.base64Image,t.LSH)}}function xt(i,a){1&i&&(t.TgZ(0,"div",21),t._UZ(1,"mat-icon",22),t.TgZ(2,"div",23),t._uU(3,"PDF"),t.qZA()()),2&i&&(t.xp6(1),t.Q6J("svgIcon","iconsmind:file"))}function bt(i,a){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"h2",24),t._uU(2,"Ver detalles del pago"),t.qZA(),t.TgZ(3,"form",25)(4,"mat-form-field"),t._UZ(5,"input",4),t.YNc(6,pt,2,0,"mat-error",0),t.qZA(),t.TgZ(7,"mat-form-field")(8,"input",26),t.NdJ("keypress",function(o){return t.CHM(e),t.oxw().onlyPositiveNumbers(o)}),t.qZA(),t.YNc(9,gt,2,0,"mat-error",0),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-select",8),t.YNc(12,_t,2,2,"mat-option",6),t.qZA(),t.YNc(13,ht,2,0,"mat-error",0),t.qZA(),t.TgZ(14,"mat-form-field"),t._UZ(15,"input",27),t.YNc(16,ft,2,0,"mat-error",0),t.qZA(),t.TgZ(17,"div",9)(18,"div",10),t.YNc(19,vt,1,1,"img",11),t.YNc(20,xt,4,1,"div",12),t.qZA()(),t.TgZ(21,"div",15)(22,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClose()}),t._uU(23," Cerrar "),t.qZA()()(),t.BQk()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("ngIf",e.form.get("description").invalid&&e.form.get("description").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("amount").invalid&&e.form.get("amount").touched),t.xp6(3),t.Q6J("ngForOf",e.months),t.xp6(1),t.Q6J("ngIf",e.form.get("month").invalid&&e.form.get("month").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("payedAt").invalid&&e.form.get("payedAt").touched),t.xp6(3),t.Q6J("ngIf",e.base64Image),t.xp6(1),t.Q6J("ngIf",!e.base64Image),t.xp6(2),t.Q6J("color","primary")}}let j=(()=>{class i{constructor(e,n,o,s,l,c,I,C){this.data=e,this._fb=n,this._session=o,this._service=s,this._snackbar=l,this._services=c,this._changeDetectorRef=I,this._dialogRef=C,this.isNew=!0,this.showImage=!1,this.invalidExtention=!1,this.invalidSize=!1,this.months=[],this.amounts=[],this.services=[],this._unsubscribeAll=new x.x}ngOnInit(){var e;this._onGetSession(),this.getMoths(),this.getAmounts(),this._getServices(),this.initForm(),(null===(e=this.data)||void 0===e?void 0:e.payment)&&this.setForm(this.data.payment)}initForm(){var e,n,o;this.isNew=!0,this.form=this._fb.group({userId:[null===(e=this.user)||void 0===e?void 0:e.id,[d.kI.required]],amount:["",[d.kI.required]],month:["",[d.kI.required]],description:["",[d.kI.required]],payedAt:[""],email:[(null===(n=this.user)||void 0===n?void 0:n.email)||(null===(o=this.user)||void 0===o?void 0:o.Email)],serviceId:["",[d.kI.required]]})}_onGetSession(){var e;(null===(e=this.data)||void 0===e?void 0:e.user)?this.user=this.data.user:this._session.user$.pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{this.user=n})}setForm(e){this.isNew=!1,this.noImageChanged=!0,this.form.patchValue({id:e.id,amount:e.amount,userId:null==e?void 0:e.userId,month:parseInt(e.month),description:e.description,payedAt:this.convertDate(e.payedAt)}),(null==e?void 0:e.photo)&&(this.base64Image=null==e?void 0:e.photo)}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}registerPayment(){if(this.form.invalid)return Object.values(this.form.controls).forEach(e=>e.markAsTouched());this._service.createPayment(this.form.value).subscribe(e=>{if(403==e.statusCode){const n=this.months.find(o=>{var s;return o.value==(null===(s=this.form.controls.month)||void 0===s?void 0:s.value)}).description;return this._snackbar.open(`Ya existe un pago registrado para el mes de ${n}.`)}return 200==e.statusCode?(this.onClose(!0),this._snackbar.open("Se ha registrado el pago exit\xf3samente.")):this._snackbar.open("Ha ocurrido un error al registrar el pago.")})}onFileSelected(e){if(e.target.files&&e.target.files[0]){const o=["image/png","image/jpeg","image/jpg","application/pdf"];if(e.target.files[0].size>2e6)return void(this.invalidSize=!0);if(!o.includes(e.target.files[0].type))return void(this.invalidExtention=!0);const s=new FileReader;s.onload=l=>{this.invalidSize=!1,this.invalidExtention=!1,this.base64Image=l.target.result,this.form.addControl("photo",this._fb.control(this.base64Image)),this.noImageChanged=!1,this._changeDetectorRef.markForCheck()},s.readAsDataURL(e.target.files[0])}}convertDate(e){return(0,f.Mu)(e)}onKeyDown(e){"Space"===e.code&&e.preventDefault()}onlyPositiveNumbers(e){const n=e.target.value+e.key;(isNaN(n)||Number(n)<=0)&&e.preventDefault()}getMoths(){this.months=this._service.getMonths()}getAmounts(){this.amounts=this._service.getAmounts()}onClose(e=!1){this._dialogRef.close(e)}onOptionSelection(e){const n=this.services.find(o=>o.id==e.value);n&&this.form.patchValue({amount:n.Price})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.WI),t.Y36(d.qu),t.Y36(J.K),t.Y36(D),t.Y36(f.cw),t.Y36(U.r),t.Y36(t.sBO),t.Y36(h.so))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-dialog"]],decls:2,vars:2,consts:[[4,"ngIf"],["mat-dialog-title","",1,"mat-dialog-payment-title"],["mat-dialog-title","","class","mat-dialog-payment-subtitle",4,"ngIf"],["name","form",3,"formGroup","ngSubmit"],["matInput","","placeholder","Detalles del pago","formControlName","description"],["placeholder","Servicio","formControlName","serviceId",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","","placeholder","Monto","formControlName","amount"],["placeholder","Mes","formControlName","month"],[1,"aspect-w-9","aspect-h-6","mt-4"],[1,"flex","items-center","justify-center","border","rounded-lg","bg-gray-50","dark:bg-card"],["class","donation-image",3,"src",4,"ngIf"],["class","relative",4,"ngIf"],[1,"mt-4"],["type","file","name","image","accept",".jpeg,.jpg,.png,.pdf",3,"change"],["mat-dialog-actions",""],["mat-button","","type","button",3,"click"],["mat-flat-button","","type","submit",3,"color","disabled"],["mat-dialog-title","",1,"mat-dialog-payment-subtitle"],[3,"value"],[1,"donation-image",3,"src"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"bg-red-600","doc-file"],["mat-dialog-title",""],["name","form",3,"formGroup"],["matInput","","placeholder","Monto","formControlName","amount",3,"keypress"],["matInput","","placeholder","Fecha de pago efectuado","formControlName","payedAt"],["mat-flat-button","",3,"color","click"]],template:function(e,n){1&e&&(t.YNc(0,dt,32,14,"ng-container",0),t.YNc(1,bt,24,9,"ng-container",0)),2&e&&(t.Q6J("ngIf",n.isNew),t.xp6(1),t.Q6J("ngIf",!n.isNew))},directives:[g.O5,h.uh,d._Y,d.JL,d.sg,T.KE,E.Nt,d.Fj,d.JJ,d.u,T.TO,Q.gD,g.sg,w.ey,A.Hw,h.H8,P.lW],styles:[".mat-form-field[_ngcontent-%COMP%]{display:grid!important;width:100%;margin-bottom:10px}.donation-image[_ngcontent-%COMP%]{height:100%;object-fit:cover}.doc-file[_ngcontent-%COMP%]{color:#fff;font-weight:700;text-align:center;font-style:italic}.mat-dialog-payment-title[_ngcontent-%COMP%]{margin:0!important}.mat-dialog-payment-subtitle[_ngcontent-%COMP%]{font-size:15px;color:gray!important}"]}),i})();var p=r(574),yt=r(4557),Y=r(6087),k=r(4847),Zt=r(3844),B=r(7238);function Tt(i,a){if(1&i&&t._UZ(0,"img",21),2&i){const e=t.oxw().$implicit;t.Q6J("src",null==e?null:e.photo,t.LSH)}}function It(i,a){1&i&&(t.TgZ(0,"div",22),t._uU(1," NO THUMB "),t.qZA())}function Ct(i,a){1&i&&t._UZ(0,"mat-icon",23),2&i&&t.Q6J("matTooltip","Pendiente de revisi\xf3n")}function At(i,a){1&i&&t._UZ(0,"mat-icon",24),2&i&&t.Q6J("matTooltip","Aprobado")}function Pt(i,a){1&i&&t._UZ(0,"mat-icon",25),2&i&&t.Q6J("matTooltip","Rechazado")}function Nt(i,a){1&i&&t._UZ(0,"mat-icon",26),2&i&&t.Q6J("matTooltip","Anulado")}function St(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(3).approve(o)}),t._UZ(1,"mat-icon",28),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("matTooltip","Aprobar pago")("disabled",2===(null==e?null:e.state)||3===(null==e?null:e.state)||4===(null==e?null:e.state))}}function Jt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(3).deny(o)}),t._UZ(1,"mat-icon",29),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("matTooltip","Denegar pago")("disabled",2===(null==e?null:e.state)||3===(null==e?null:e.state)||4===(null==e?null:e.state))}}function Dt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw(3).cancel(o)}),t._UZ(1,"mat-icon",30),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("matTooltip","Anular pago")("disabled",(null==e?null:e.state)<=1||(null==e?null:e.state)>=4)}}function Ut(i,a){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"div",7)(3,"div",8),t.YNc(4,Tt,1,1,"img",9),t.YNc(5,It,2,0,"div",10),t.qZA()(),t.TgZ(6,"div",11),t._uU(7),t.qZA(),t.TgZ(8,"div",11),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"div",11),t._uU(12),t.qZA(),t.TgZ(13,"div",11),t._uU(14),t.qZA(),t.TgZ(15,"div",11),t.YNc(16,Ct,1,1,"mat-icon",12),t.YNc(17,At,1,1,"mat-icon",13),t.YNc(18,Pt,1,1,"mat-icon",14),t.YNc(19,Nt,1,1,"mat-icon",15),t.qZA(),t.TgZ(20,"div")(21,"button",16),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(3).openDialog(s)}),t._UZ(22,"mat-icon",17),t.qZA(),t.YNc(23,St,2,2,"button",18),t.YNc(24,Jt,2,2,"button",18),t.YNc(25,Dt,2,2,"button",18),t.TgZ(26,"button",19),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(3).downloadRecipe(null==s?null:s.recipe)}),t._UZ(27,"mat-icon",20),t.qZA()()(),t.BQk()}if(2&i){const e=a.$implicit,n=t.oxw(3);t.xp6(4),t.Q6J("ngIf",null==e?null:e.photo),t.xp6(1),t.Q6J("ngIf",!(null!=e&&e.photo)),t.xp6(2),t.hij(" ",n.translateService(null==e?null:e.serviceId)," "),t.xp6(2),t.hij(" ",t.gM2(10,15,null==e?null:e.amount,"GTQ","symbol","1.2-2")," "),t.xp6(3),t.hij(" ",n.convertMonth(null==e?null:e.month)," "),t.xp6(2),t.hij(" ",n.convertDate(null==e?null:e.payedAt)," "),t.xp6(2),t.Q6J("ngIf",1===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",2===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",3===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",4===(null==e?null:e.state)),t.xp6(4),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("disabled",2!==(null==e?null:e.state))("matTooltip","Descargar comprobante")}}function Qt(i,a){if(1&i&&(t.ynx(0),t.YNc(1,Ut,28,20,"ng-container",5),t.BQk()),2&i){const e=a.ngIf,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e)("ngForTrackBy",n.trackByFn)}}const wt=function(i){return{"pointer-events-none":i}};function Yt(i,a){if(1&i&&(t.ynx(0),t.TgZ(1,"div",1)(2,"div",2),t._UZ(3,"div",3),t.TgZ(4,"div"),t._uU(5,"Servicio"),t.qZA(),t.TgZ(6,"div"),t._uU(7,"Monto"),t.qZA(),t.TgZ(8,"div"),t._uU(9,"Mes"),t.qZA(),t.TgZ(10,"div"),t._uU(11,"Fecha de pago"),t.qZA(),t.TgZ(12,"div"),t._uU(13,"Estado"),t.qZA(),t.TgZ(14,"div"),t._uU(15,"Opciones"),t.qZA()(),t.YNc(16,Qt,2,2,"ng-container",0),t.ALo(17,"async"),t.qZA(),t._UZ(18,"mat-paginator",4),t.BQk()),2&i){const e=t.oxw();t.xp6(16),t.Q6J("ngIf",t.lcZ(17,4,e.payments$)),t.xp6(2),t.Q6J("ngClass",t.VKq(6,wt,e.loading))("length",e.count)("pageSizeOptions",e.pageSizeOptions)}}function kt(i,a){1&i&&(t.ynx(0),t.TgZ(1,"div",31),t._UZ(2,"mat-icon",32),t.TgZ(3,"div",33),t._uU(4," No se han encontrado pagos realizados. "),t.qZA()(),t.BQk()),2&i&&(t.xp6(2),t.Q6J("svgIcon","heroicons_outline:document"))}let Mt=(()=>{class i{constructor(e,n,o,s,l,c){this.dialog=e,this._user=n,this._payment=o,this._snackbar=s,this._services=l,this._changeDetectorRef=c,this._unsubscribeAll=new x.x,this.payments=[],this.pageSize=10,this.page=1,this.count=0,this.pages=0,this.pageSizeOptions=[10,15,25],this.services=[]}ngOnInit(){this._onGetSession(),this._getServices(),this.onListenDialog(),this.onChangeNeighbors(),this.getPayments()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}getPayments(e,n=1,o=10){var s;try{const l=e||parseInt(null===(s=this.user)||void 0===s?void 0:s.id);this.loading=!0,this._payment.getPayments({page:n,pageSize:o,userId:l}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(c=>{this.payments=c.payments,this.page=c.page,this.count=c.total,this.pages=c.pages,this.loading=!1,this._changeDetectorRef.markForCheck()}),this.payments$=this._payment.payments$}catch(l){console.log(l)}}_onGetSession(){this._user.user$.pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.user=e})}onListenDialog(){this._payment.dialogStatus.pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.getPayments(this.userId,this.page,this.pageSize)})}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}approve(e){this._payment.approvePayment({paymentId:e.id,userId:e.userId}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{this._snackbar.open(200!=(null==n?void 0:n.statusCode)?"Ha ocurrido un error al aprobar el pago.":"Se ha aprobado el pago de manera exit\xf3sa."),200==n.statusCode&&this.getPayments(this.userId,this.page,this.pageSize)})}deny(e){this._payment.denyPayment({paymentId:e.id,userId:e.userId}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{this._snackbar.open(200!=(null==n?void 0:n.statusCode)?"Ha ocurrido un error al denegar el pago.":"Se ha denegado el pago de manera exit\xf3sa."),200==n.statusCode&&this.getPayments(this.userId,this.page,this.pageSize)})}cancel(e){this._payment.cancelPayment({paymentId:e.id,userId:e.userId}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{this._snackbar.open(200!=(null==n?void 0:n.statusCode)?"Ha ocurrido un error al anular el pago.":"Se ha anulado el pago de manera exit\xf3sa."),200==n.statusCode&&this.getPayments(this.userId,this.page,this.pageSize)})}onChangeNeighbors(){this._payment.userId$.pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.userId=e,this.getPayments(e)})}convertDate(e){return(0,f.Mu)(e)}convertMonth(e){var n;return null===(n=this._payment.getMonths().find(s=>s.value==e))||void 0===n?void 0:n.description}openDialog(e){this.dialog.open(j,{width:"500px",data:{payment:e}})}translateService(e){var n;return(null===(n=this.services.find(o=>o.id===e))||void 0===n?void 0:n.Name)||""}downloadRecipe(e){this._payment.download(e).pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{const o=null==e?void 0:e.replace(/.*_/,""),s=new Blob([n],{type:"application/pdf"}),l=window.URL.createObjectURL(s),c=document.createElement("a");c.href=l,c.download=o,c.click(),window.URL.revokeObjectURL(l)})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(h.uw),t.Y36(J.K),t.Y36(D),t.Y36(f.cw),t.Y36(U.r),t.Y36(t.sBO))},i.\u0275cmp=t.Xpm({type:i,selectors:[["payment-list"]],viewQuery:function(e,n){if(1&e&&(t.Gf(Y.NW,5),t.Gf(k.YE,5)),2&e){let o;t.iGM(o=t.CRH())&&(n._paginator=o.first),t.iGM(o=t.CRH())&&(n._sort=o.first)}},decls:2,vars:2,consts:[[4,"ngIf"],[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-grid-payment","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"hidden","sm:block"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageSizeOptions"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-grid-payment","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b"],[1,"flex","items-center"],[1,"relative","flex","flex-0","items-center","justify-center","w-12","h-12","mr-6","rounded","overflow-hidden","border"],["class","donation-photo-list",3,"src",4,"ngIf"],["class","flex items-center justify-center w-full h-full text-xs font-semibold leading-none text-center uppercase",4,"ngIf"],[1,"truncate"],["style","color: rgb(3, 159, 187)","svgIcon","heroicons_outline:information-circle",3,"matTooltip",4,"ngIf"],["style","color: green","svgIcon","heroicons_outline:check-circle",3,"matTooltip",4,"ngIf"],["style","color: red","svgIcon","heroicons_outline:x-circle",3,"matTooltip",4,"ngIf"],["style","color: rgb(255, 145, 0)","svgIcon","heroicons_outline:minus-circle",3,"matTooltip",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6",3,"click"],["svgIcon","heroicons_outline:pencil-alt"],["mat-stroked-button","","class","min-w-10 min-h-7 h-7 px-2 leading-6 ml-2",3,"matTooltip","disabled","click",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"disabled","matTooltip","click"],["svgIcon","heroicons_outline:save"],[1,"donation-photo-list",3,"src"],[1,"flex","items-center","justify-center","w-full","h-full","text-xs","font-semibold","leading-none","text-center","uppercase"],["svgIcon","heroicons_outline:information-circle",2,"color","rgb(3, 159, 187)",3,"matTooltip"],["svgIcon","heroicons_outline:check-circle",2,"color","green",3,"matTooltip"],["svgIcon","heroicons_outline:x-circle",2,"color","red",3,"matTooltip"],["svgIcon","heroicons_outline:minus-circle",2,"color","rgb(255, 145, 0)",3,"matTooltip"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"matTooltip","disabled","click"],["svgIcon","heroicons_outline:check"],["svgIcon","heroicons_outline:x"],["svgIcon","heroicons_outline:reply"],[1,"flex","flex-col","flex-auto","items-center","justify-center",2,"margin-top","17%"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(e,n){1&e&&(t.YNc(0,Yt,19,8,"ng-container",0),t.YNc(1,kt,5,1,"ng-container",0)),2&e&&(t.Q6J("ngIf",n.count),t.xp6(1),t.Q6J("ngIf",!n.count&&!n.loading))},directives:[g.O5,k.YE,g.sg,A.Hw,B.gM,P.lW,Y.NW,g.mk],pipes:[g.Ov,g.H9],styles:[".inventory-grid-payment{grid-template-columns:3.5fr 1.5fr 1fr}@media (min-width: 600px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}@media (min-width: 960px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}@media (min-width: 1280px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}.donation-photo-list{height:100%;width:100%}\n"],encapsulation:2,data:{animation:Zt.L},changeDetection:0}),i})();function qt(i,a){if(1&i&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.DisplayName)}}function Ot(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"mat-form-field",17),t._UZ(1,"mat-icon",18),t.TgZ(2,"mat-select",19,20),t.NdJ("selectionChange",function(o){return t.CHM(e),t.oxw().onOptionSelection(o)}),t.YNc(4,qt,2,2,"mat-option",21),t.ALo(5,"async"),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("svgIcon","heroicons_solid:search"),t.xp6(1),t.Q6J("formControl",e.searchInputControl),t.xp6(2),t.Q6J("ngForOf",t.lcZ(5,3,e.neighbors$))}}const Ft=[{path:"",component:(()=>{class i{constructor(e,n,o,s,l,c){this._user=e,this._dialog=n,this._session=o,this._payments=s,this._snackbar=l,this._services=c,this.services=[],this.payments=[],this._unsubscribeAll=new x.x,this.searchInputControl=new d.NI}ngOnInit(){this.onValidateRole(),this._onChangeSelection(),this._getServices()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}onValidateRole(){this._session.user$.pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.user=e,1===(null==e?void 0:e.role)&&this.onGetNeighbor()})}onGetNeighbor(){var e=this;return(0,K.Z)(function*(){1===e.user.role&&(e._user.getNeighbors().pipe((0,m.R)(e._unsubscribeAll)).subscribe(n=>{var o;e.neighbors=n,e.searchInputControl.setValue(null===(o=n[0])||void 0===o?void 0:o.id),e.optionSelected=n[0]}),e.neighbors$=e._user.neighbors$)})()}onExportData(){var e,n,o,s,l,c,I,C,M,q,O,F,L,R;if(!this.payments.length)return this._snackbar.open("No existen datos para este usuario a exportar.");const Bt=null===(e=this.payments)||void 0===e?void 0:e.map(S=>{var u=(0,V._T)(S,["id","userId","photo"]);return{Monto:null==u?void 0:u.amount,Descripcion:null==u?void 0:u.description,Fecha:this._convertDate(null==u?void 0:u.payedAt),Mes:this._convertMonth(parseInt(null==u?void 0:u.month)),Servicio:this._translateService(null==u?void 0:u.serviceId),Estado:this._translateState(null==u?void 0:u.state)}}),Gt=null===(n=this.payments)||void 0===n?void 0:n.reduce((S,$)=>S+((2==$.state?$.amount:0)||0),0),N=(null===(o=this.optionSelected)||void 0===o?void 0:o.DisplayName)?null===(l=this.optionSelected)||void 0===l?void 0:l.DisplayName:null===(s=this.user)||void 0===s?void 0:s.name,Kt=(null===(c=this.optionSelected)||void 0===c?void 0:c.Dpi)?null===(C=this.optionSelected)||void 0===C?void 0:C.Dpi:null===(I=this.user)||void 0===I?void 0:I.dpi,Vt=(null===(M=this.optionSelected)||void 0===M?void 0:M.Direccion)?null===(O=this.optionSelected)||void 0===O?void 0:O.Direccion:null===(q=this.user)||void 0===q?void 0:q.direccion,Xt=(null===(F=this.optionSelected)||void 0===F?void 0:F.Telefono)?null===(R=this.optionSelected)||void 0===R?void 0:R.Telefono:null===(L=this.user)||void 0===L?void 0:L.telefono,Wt=`${null==N?void 0:N.replace(" ","_")}_${this._getHexadecimalDate()}.xlsx`,_=p.P6.aoa_to_sheet([]);p.P6.sheet_add_aoa(_,[["Usuario: "+N]],{origin:"A1"}),p.P6.sheet_add_aoa(_,[["Documento Personal de Identificaci\xf3n : "+Kt]],{origin:"A2"}),p.P6.sheet_add_aoa(_,[["Direcci\xf3n: "+Vt]],{origin:"A3"}),p.P6.sheet_add_aoa(_,[["Telefono: "+Xt]],{origin:"A4"}),p.P6.sheet_add_aoa(_,[["Subotal (Aprobados y pendientes): Q"+Gt]],{origin:"A5"}),p.P6.sheet_add_aoa(_,[[]],{origin:-1}),p.P6.sheet_add_json(_,Bt,{origin:-1});const G=p.P6.book_new();p.P6.book_append_sheet(G,_,"COCODE CUILCO"),p.NC(G,Wt)}onOptionSelection(e){this.optionSelected=this.neighbors.find(n=>n.id==e.value),this._payments.userId.next(e.value)}openDialog(){this._dialog.open(j,{width:"500px",data:{user:this.optionSelected}}).afterClosed().pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>this._payments.listenDialog())}_onChangeSelection(){this._payments.payments$.pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.payments=e})}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}_convertDate(e){return(0,f.Mu)(e)}_convertMonth(e){var n;return null===(n=this._payments.getMonths().find(s=>s.value==e))||void 0===n?void 0:n.description}_translateService(e){var n;return(null===(n=this.services.find(o=>o.id===e))||void 0===n?void 0:n.Name)||""}_translateState(e){switch(e){case 2:return"Aprobado";case 3:return"Rechazado";case 4:return"Anulado";default:return"Pendiente"}}_getHexadecimalDate(){return Date.now().toString(16)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(yt.K),t.Y36(h.uw),t.Y36(J.K),t.Y36(D),t.Y36(f.cw),t.Y36(U.r))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-payment"]],decls:22,vars:4,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["class","fuse-mat-dense fuse-mat-no-subscript fuse-mat-rounded min-w-64",4,"ngIf"],["mat-flat-button","",1,"ml-4","mr-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-wrap","ml-2","mt-2"],[1,"flex","flex-col","w-18","h-18","m-2","p-4","rounded-2xl","cursor-pointer","bg-card",3,"click"],[1,"aspect-w-9","aspect-h-6"],[1,"flex","items-center","justify-center"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"absolute","left-0","bottom-0","px-1.5","rounded","text-sm","font-semibold","leading-5","text-white","bg-green-600"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","selectionChange"],["residenceSelect",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Pagos"),t.qZA(),t.TgZ(4,"div",3),t.YNc(5,Ot,6,5,"mat-form-field",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return n.openDialog()}),t._UZ(7,"mat-icon",6),t.TgZ(8,"span",7),t._uU(9,"Realizar pago"),t.qZA()(),t.TgZ(10,"div",8),t.ynx(11),t.TgZ(12,"a",9),t.NdJ("click",function(){return n.onExportData()}),t.TgZ(13,"div",10)(14,"div",11)(15,"div",12),t._UZ(16,"mat-icon",13),t.TgZ(17,"div",14),t._uU(18," XLSX "),t.qZA()()()()(),t.BQk(),t.qZA()()(),t.TgZ(19,"div",15)(20,"div",16),t._UZ(21,"payment-list"),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:plus"),t.xp6(9),t.Q6J("svgIcon","iconsmind:file"))},directives:[g.O5,T.KE,A.Hw,T.qo,Q.gD,d.JJ,d.oH,g.sg,w.ey,P.lW,Mt],pipes:[g.Ov],encapsulation:2}),i})()}];let Lt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[z.Bz.forChild(Ft)],z.Bz]}),i})();var Rt=r(4466),$t=r(7446),Ht=r(2181),zt=r(5899),Et=r(2368);let jt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[Rt.m,Lt,P.ot,$t.p9,T.lN,A.Ps,E.c,Ht.Tx,Y.TU,zt.Cv,w.si,k.JX,Q.LD,Et.rP,B.AV,h.Is]]}),i})()}}]);