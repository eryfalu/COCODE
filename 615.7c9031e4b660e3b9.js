"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[615],{8615:(ht,W,i)=>{i.r(W),i.d(W,{WageModule:()=>ft});var I=i(4521),D=i(5861),O=i(655),b=i(7579),g=i(2722),c=i(3075),d=i(8966),t=i(5e3),j=i(4557),k=i(1135),p=i(4004),f=i(262),h=i(9646),F=i(6805),L=i(930),M=i(2340),$=i(520);const v=M.N.base_url;let C=(()=>{class o{constructor(e){this._http=e,this._onlistenSubject=new b.x,this._wages=new k.X(null)}get wages$(){return this._wages.asObservable()}listenDialog(){this._onlistenSubject.next()}get dialogStatus(){return this._onlistenSubject.asObservable()}create(e){return this._http.post(`${v}/wage/create`,e,this._getHeaders).pipe((0,p.U)(n=>n.statusCode?n.statusCode:500),(0,f.K)(n=>(0,h.of)(n.status)))}updateState(e){return this._http.put(`${v}/wage/status`,e,this._getHeaders).pipe((0,p.U)(n=>n.statusCode?n.statusCode:500),(0,f.K)(n=>(0,h.of)(n.status)))}delete(e){return this._http.delete(`${v}/wage/delete/${e}`,this._getHeaders).pipe((0,p.U)(n=>n.statusCode?n.statusCode:500),(0,f.K)(n=>(0,h.of)(n.status)))}findWages(e){return this._http.post(`${v}/wage/findPaginated`,e,this._getHeaders).pipe((0,p.U)(n=>n.statusCode&&200==n.statusCode?(this._wages.next(n.wages),{page:n.page,total:n.total,pages:n.pages,wages:n.wages}):null),(0,f.K)(n=>(0,h.of)(null)))}findAll(){var e=this;return(0,D.Z)(function*(){return function H(o,s){const e="object"==typeof s;return new Promise((n,r)=>{const l=new L.Hp({next:u=>{n(u),l.unsubscribe()},error:r,complete:()=>{e?n(s.defaultValue):r(new F.K)}});o.subscribe(l)})}(e._http.get(`${v}/wage/find`,e._getHeaders).pipe((0,p.U)(n=>n.statusCode&&200===n.statusCode?n.wages:null),(0,f.K)(n=>(0,h.of)([]))))})()}get _getToken(){return localStorage.getItem("x-token")||""}get _getHeaders(){return{headers:{"x-token":this._getToken}}}}return o.\u0275fac=function(e){return new(e||o)(t.LFG($.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var _=i(1937),R=i(7550),A=i(7322),J=i(4102),m=i(9808),N=i(508),Q=i(7531),Z=i(7423);function E(o,s){if(1&o&&(t.TgZ(0,"mat-option",11),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.Email),t.xp6(1),t.Oqu(e.DisplayName)}}function z(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function q(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function B(o,s){if(1&o&&(t.TgZ(0,"mat-option",11),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e.Name),t.xp6(1),t.Oqu(e.Name)}}function G(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function P(o,s){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}let K=(()=>{class o{constructor(e,n,r,l,u,T,y){this.data=e,this._fb=n,this._user=r,this._service=l,this._snackbar=u,this._services=T,this._dialogRef=y,this.services=[],this._unsubscribeAll=new b.x}ngOnInit(){this._getNeighbors(),this._getServices(),this._initForm()}registerWage(){if(this.form.invalid)return Object.values(this.form.controls).forEach(e=>e.markAsTouched());this._service.create(this.form.getRawValue()).pipe((0,g.R)(this._unsubscribeAll)).subscribe(e=>{const n=200===e?"Se ha registrado el jornal exit\xf3samente.":"Ha ocurrido un error al registrar el jornal.";this.onClose(200===e),this._snackbar.open(n)})}onClose(e=!1){this._dialogRef.close(e)}_initForm(){this.form=this._fb.group({user:["",c.kI.required],amount:["",c.kI.required],service:["",c.kI.required],description:["",c.kI.required]})}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,g.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services,console.log(this.services)}),this.services$=this._services.services$}_getNeighbors(){this._user.getNeighbors().pipe((0,g.R)(this._unsubscribeAll)).subscribe(e=>{this.neighbors=e}),this.neighbors$=this._user.neighbors$}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.WI),t.Y36(c.qu),t.Y36(j.K),t.Y36(C),t.Y36(_.cw),t.Y36(R.r),t.Y36(d.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog"]],decls:22,vars:9,consts:[["mat-dialog-title",""],["name","form",3,"formGroup","ngSubmit"],["placeholder","Vecino","formControlName","user"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","placeholder","Description","formControlName","description"],["placeholder","Servicio","formControlName","service"],["matInput","","placeholder","Monto","formControlName","amount"],["mat-dialog-actions",""],["mat-button","","type","button",3,"click"],["type","submit","mat-flat-button","",3,"color","disabled"],[3,"value"]],template:function(e,n){1&e&&(t.TgZ(0,"h2",0),t._uU(1,"Registrar jornal"),t.qZA(),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return n.registerWage()}),t.TgZ(3,"mat-form-field")(4,"mat-select",2),t.YNc(5,E,2,2,"mat-option",3),t.qZA(),t.YNc(6,z,2,0,"mat-error",4),t.qZA(),t.TgZ(7,"mat-form-field"),t._UZ(8,"input",5),t.YNc(9,q,2,0,"mat-error",4),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-select",6),t.YNc(12,B,2,2,"mat-option",3),t.qZA(),t.YNc(13,G,2,0,"mat-error",4),t.qZA(),t.TgZ(14,"mat-form-field"),t._UZ(15,"input",7),t.YNc(16,P,2,0,"mat-error",4),t.qZA(),t.TgZ(17,"div",8)(18,"button",9),t.NdJ("click",function(){return n.onClose()}),t._uU(19,"Cancelar"),t.qZA(),t.TgZ(20,"button",10),t._uU(21," Crear "),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("formGroup",n.form),t.xp6(3),t.Q6J("ngForOf",n.neighbors),t.xp6(1),t.Q6J("ngIf",n.form.get("user").invalid&&n.form.get("user").touched),t.xp6(3),t.Q6J("ngIf",n.form.get("description").invalid&&n.form.get("description").touched),t.xp6(3),t.Q6J("ngForOf",n.services),t.xp6(1),t.Q6J("ngIf",n.form.get("service").invalid&&n.form.get("service").touched),t.xp6(3),t.Q6J("ngIf",n.form.get("amount").invalid&&n.form.get("amount").touched),t.xp6(4),t.Q6J("color","primary")("disabled",n.form.invalid||n.form.pristine))},directives:[d.uh,c._Y,c.JL,c.sg,A.KE,J.gD,c.JJ,c.u,m.sg,N.ey,m.O5,A.TO,Q.Nt,c.Fj,d.H8,Z.lW],styles:[".mat-form-field[_ngcontent-%COMP%]{display:grid!important;width:100%;margin-bottom:10px}.doc-file[_ngcontent-%COMP%]{color:#fff;text-align:center;font-weight:700;font-style:italic}"]}),o})();var x=i(574),w=i(5245),S=i(4847),U=i(6087),V=i(3844),Y=i(7238);function X(o,s){1&o&&t._UZ(0,"mat-icon",13),2&o&&t.Q6J("matTooltip","Denegado")}function tt(o,s){1&o&&t._UZ(0,"mat-icon",14),2&o&&t.Q6J("matTooltip","Pagado")}function et(o,s){1&o&&t._UZ(0,"mat-icon",15),2&o&&t.Q6J("matTooltip","Pendiente")}function nt(o,s){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",5)(2,"div",6),t._uU(3),t.qZA(),t.TgZ(4,"div",6),t._uU(5),t.qZA(),t.TgZ(6,"div",6),t._uU(7),t.qZA(),t.TgZ(8,"div",6),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"div",6),t._uU(12),t.qZA(),t.TgZ(13,"div",6),t.YNc(14,X,1,1,"mat-icon",7),t.YNc(15,tt,1,1,"mat-icon",8),t.YNc(16,et,1,1,"mat-icon",9),t.qZA(),t.TgZ(17,"div")(18,"button",10),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw(3).payWage(null==l?null:l.Id)}),t._UZ(19,"mat-icon",11),t.qZA(),t.TgZ(20,"button",10),t.NdJ("click",function(){const l=t.CHM(e).$implicit;return t.oxw(3).removeWage(null==l?null:l.Id)}),t._UZ(21,"mat-icon",12),t.qZA()()(),t.BQk()}if(2&o){const e=s.$implicit,n=t.oxw(3);t.xp6(3),t.hij(" ",null==e?null:e.User," "),t.xp6(2),t.hij(" ",null==e?null:e.Service," "),t.xp6(2),t.hij(" ",null==e?null:e.Description," "),t.xp6(2),t.hij(" ",t.gM2(10,12,null==e?null:e.Amount,"GTQ","symbol","1.2-2")," "),t.xp6(3),t.hij(" ",n.convertDate(null==e?null:e.CreatedAt)," "),t.xp6(2),t.Q6J("ngIf",3===(null==e?null:e.Status)),t.xp6(1),t.Q6J("ngIf",2===(null==e?null:e.Status)),t.xp6(1),t.Q6J("ngIf",1===(null==e?null:e.Status)),t.xp6(2),t.Q6J("matTooltip","Marcar como pagado")("disabled",2===(null==e?null:e.Status)||null!==(null==e?null:e.DeletedAt)),t.xp6(2),t.Q6J("matTooltip","Denegar")("disabled",null!==(null==e?null:e.DeletedAt)||2===(null==e?null:e.Status))}}function ot(o,s){if(1&o&&(t.ynx(0),t.YNc(1,nt,22,17,"ng-container",4),t.BQk()),2&o){const e=s.ngIf,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e)("ngForTrackBy",n.trackByFn)}}const it=function(o){return{"pointer-events-none":o}};function st(o,s){if(1&o&&(t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div"),t._uU(4,"Vecino"),t.qZA(),t.TgZ(5,"div"),t._uU(6,"Servicio"),t.qZA(),t.TgZ(7,"div"),t._uU(8,"Descripci\xf3n"),t.qZA(),t.TgZ(9,"div"),t._uU(10,"Monto"),t.qZA(),t.TgZ(11,"div"),t._uU(12,"Fecha"),t.qZA(),t.TgZ(13,"div"),t._uU(14,"Estado"),t.qZA(),t.TgZ(15,"div"),t._uU(16,"Opciones"),t.qZA()(),t.YNc(17,ot,2,2,"ng-container",0),t.ALo(18,"async"),t.qZA(),t._UZ(19,"mat-paginator",3),t.BQk()),2&o){const e=t.oxw();t.xp6(17),t.Q6J("ngIf",t.lcZ(18,4,e.wages$)),t.xp6(2),t.Q6J("length",e.count)("pageSizeOptions",e.pageSizeOptions)("ngClass",t.VKq(6,it,e.loading))}}function rt(o,s){1&o&&(t.ynx(0),t.TgZ(1,"div",16),t._UZ(2,"mat-icon",17),t.TgZ(3,"div",18),t._uU(4," No se han encontrado jornales. "),t.qZA()(),t.BQk()),2&o&&(t.xp6(2),t.Q6J("svgIcon","heroicons_outline:document"))}let at=(()=>{class o{constructor(e,n,r){this._wage=e,this._cdr=n,this._snackbar=r,this.wages=[],this.page=1,this.count=0,this.pages=0,this.pageSize=10,this.pageSizeOptions=[10,15,25],this._unsubscribeAll=new b.x}ngOnInit(){this._onGetWages(),this._onListenDialog()}convertDate(e){return(0,_.Mu)(e)}_onGetWages(e=1,n=10){try{this.loading=!0,this._wage.findWages({page:e,pageSize:n}).pipe((0,g.R)(this._unsubscribeAll)).subscribe(r=>{this.loading=!1,this.page=r.page,this.count=r.total,this.pages=r.pages,this.wages=r.wages,this._cdr.markForCheck()}),this.wages$=this._wage.wages$}catch(r){console.log(r)}finally{this.loading=!1}}payWage(e){this._wage.updateState({id:e,status:2}).pipe((0,g.R)(this._unsubscribeAll)).subscribe(n=>{this._snackbar.open(200===n?"Se ha actualizado el estado del jornal exit\xf3samente.":"Ha ocurrido un error al marcar como pagado el jornal."),200===n&&this._onGetWages()})}removeWage(e){this._wage.delete(e).pipe((0,g.R)(this._unsubscribeAll)).subscribe(n=>{this._snackbar.open(200===n?"Se ha eliminado jornal exit\xf3samente.":"Ha ocurrido un error al eliminar el jornal."),200===n&&this._onGetWages()})}_onListenDialog(){this._wage.dialogStatus.pipe((0,g.R)(this._unsubscribeAll)).subscribe(e=>this._onGetWages(this.page,this.pageSize))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(C),t.Y36(t.sBO),t.Y36(_.cw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["wage-list"]],viewQuery:function(e,n){if(1&e&&(t.Gf(S.YE,5),t.Gf(U.NW,5)),2&e){let r;t.iGM(r=t.CRH())&&(n._sort=r.first),t.iGM(r=t.CRH())&&(n._paginator=r.first)}},decls:2,vars:2,consts:[[4,"ngIf"],[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-grid-wage","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"length","pageSizeOptions","ngClass"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-grid-wage","wage-row","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b"],[1,"truncate"],["style","color: red","svgIcon","heroicons_outline:x-circle",3,"matTooltip",4,"ngIf"],["style","color: green","svgIcon","heroicons_outline:check-circle",3,"matTooltip",4,"ngIf"],["style","color: rgb(3, 159, 187)","svgIcon","heroicons_outline:information-circle",3,"matTooltip",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"matTooltip","disabled","click"],["svgIcon","heroicons_outline:receipt-tax"],["svgIcon","heroicons_outline:document-remove"],["svgIcon","heroicons_outline:x-circle",2,"color","red",3,"matTooltip"],["svgIcon","heroicons_outline:check-circle",2,"color","green",3,"matTooltip"],["svgIcon","heroicons_outline:information-circle",2,"color","rgb(3, 159, 187)",3,"matTooltip"],[1,"flex","flex-col","flex-auto","items-center","justify-center",2,"margin-top","17%"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(e,n){1&e&&(t.YNc(0,st,20,8,"ng-container",0),t.YNc(1,rt,5,1,"ng-container",0)),2&e&&(t.Q6J("ngIf",n.count),t.xp6(1),t.Q6J("ngIf",!n.count&&!n.loading))},directives:[m.O5,S.YE,m.sg,w.Hw,Y.gM,Z.lW,U.NW,m.mk],pipes:[m.Ov,m.H9],styles:[".inventory-grid-wage{grid-template-columns:3.5fr 1.5fr 1fr}@media (min-width: 600px){.inventory-grid-wage{grid-template-columns:1.5fr 1fr 2fr 1fr 1fr .5fr 1fr}}@media (min-width: 960px){.inventory-grid-wage{grid-template-columns:1.5fr 1fr 2fr 1fr 1fr .5fr 1fr}}@media (min-width: 1280px){.inventory-grid-wage{grid-template-columns:1.5fr 1fr 2fr 1fr 1fr .5fr 1fr}}.wage-row{height:70px}\n"],encapsulation:2,data:{animation:V.L},changeDetection:0}),o})();const lt=[{path:"",component:(()=>{class o{constructor(e,n,r){this._dialog=e,this._service=n,this._snackbar=r,this._unsubscribeAll=new b.x}ngOnInit(){}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}openDialog(){this._dialog.open(K,{width:"500px"}).afterClosed().pipe((0,g.R)(this._unsubscribeAll)).subscribe(n=>this._service.listenDialog())}onExportData(){var e=this;return(0,D.Z)(function*(){const n=yield e._service.findAll();if(!n)return e._snackbar.open("No existen jornales para exportar.");const r=null==n?void 0:n.map(y=>{var a=(0,O._T)(y,["Id"]);return{Usuario:null==a?void 0:a.User,Servicio:null==a?void 0:a.Service,Monto:`Q ${null==a?void 0:a.Amount}`,Descripci\u00f3n:null==a?void 0:a.Description,Estado:e._translateState(null==a?void 0:a.Status),Fecha:e._convertDate(null==a?void 0:a.CreatedAt)}}),l=`${e._getHexadecimalDate()}.xlsx`,u=x.P6.aoa_to_sheet([]),T=x.P6.book_new();x.P6.sheet_add_json(u,r),x.P6.book_append_sheet(T,u,"COCODE CUILCO - Jornales"),x.NC(T,l)})()}_convertDate(e){return(0,_.Mu)(e)}_translateState(e){switch(e){case 3:return"Denegado";case 2:return"Pagado";default:return"Pendiente"}}_getHexadecimalDate(){return Date.now().toString(16)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.uw),t.Y36(C),t.Y36(_.cw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-wage"]],decls:23,vars:3,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["mat-flat-button","",1,"ml-4","mr-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-wrap","ml-2","mt-2"],[1,"flex","flex-col","w-18","h-18","m-2","p-4","rounded-2xl","cursor-pointer","bg-card",3,"click"],[1,"aspect-w-9","aspect-h-6"],[1,"flex","items-center","justify-center"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"absolute","left-0","bottom-0","px-1.5","rounded","text-sm","font-semibold","leading-5","text-white","bg-green-600"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"]],template:function(e,n){1&e&&(t.TgZ(0,"p"),t._uU(1,"wage works!"),t.qZA(),t.TgZ(2,"div",0)(3,"div",1)(4,"div",2),t._uU(5,"Jornales"),t.qZA(),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return n.openDialog()}),t._UZ(8,"mat-icon",5),t.TgZ(9,"span",6),t._uU(10,"Registrar"),t.qZA()(),t.TgZ(11,"div",7),t.ynx(12),t.TgZ(13,"a",8),t.NdJ("click",function(){return n.onExportData()}),t.TgZ(14,"div",9)(15,"div",10)(16,"div",11),t._UZ(17,"mat-icon",12),t.TgZ(18,"div",13),t._uU(19," XLSX "),t.qZA()()()()(),t.BQk(),t.qZA()()(),t.TgZ(20,"div",14)(21,"div",15),t._UZ(22,"wage-list"),t.qZA()()()),2&e&&(t.xp6(7),t.Q6J("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:plus"),t.xp6(9),t.Q6J("svgIcon","iconsmind:file"))},directives:[Z.lW,w.Hw,at],styles:[""]}),o})()}];let ct=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[I.Bz.forChild(lt)],I.Bz]}),o})();var gt=i(4466),ut=i(7446),mt=i(2181),dt=i(5899),pt=i(2368);let ft=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[gt.m,ct,Z.ot,ut.p9,A.lN,w.Ps,Q.c,mt.Tx,U.TU,dt.Cv,N.si,S.JX,J.LD,pt.rP,Y.AV,d.Is]]}),o})()}}]);