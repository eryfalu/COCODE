"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[677],{3677:(le,$,r)=>{r.r($),r.d($,{PaymentModule:()=>ee});var z=r(4521),K=r(655),c=r(3075),b=r(1937),f=r(7579),u=r(2722),X=r(8372),W=r(3900),h=r(8966),t=r(5e3),D=r(7495),tt=r(1135),y=r(4004),C=r(262),Z=r(9646),et=r(2340),nt=r(520);const x=et.N.base_url;let w=(()=>{class o{constructor(e){this._http=e,this.userId=new f.x,this.onlistenSubject=new f.x,this._payments=new tt.X(null)}get userId$(){return this.userId.asObservable()}get payments$(){return this._payments.asObservable()}getPayments(e){return this._http.post(`${x}/payment/payments`,e,this.getHeaders).pipe((0,y.U)(n=>n.statusCode&&200==n.statusCode?(this._payments.next(n.data),{payments:n.data,total:n.count,page:n.page,pages:n.pages}):null),(0,C.K)(n=>(0,Z.of)(null)))}createPayment(e){return this._http.post(`${x}/payment/create`,e,this.getHeaders).pipe((0,y.U)(n=>({statusCode:(null==n?void 0:n.statusCode)||500,filename:null==n?void 0:n.recipe})),(0,C.K)(n=>(0,Z.of)({statusCode:n.status,filename:""})))}approvePayment(e){return this._http.put(`${x}/payment/approve`,e,this.getHeaders).pipe((0,y.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,C.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}denyPayment(e){return this._http.put(`${x}/payment/deny`,e,this.getHeaders).pipe((0,y.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,C.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}cancelPayment(e){return this._http.put(`${x}/payment/cancel`,e,this.getHeaders).pipe((0,y.U)(n=>({updated:(null==n?void 0:n.updated)||!1,statusCode:(null==n?void 0:n.statusCode)||500})),(0,C.K)(n=>(0,Z.of)({statusCode:n.status,updated:!1})))}getMonths(){const n=(new Date).getMonth()+1;return[{description:"Enero",value:1},{description:"Febrero",value:2},{description:"Marzo",value:3},{description:"Abril",value:4},{description:"Mayo",value:5},{description:"Junio",value:6},{description:"Julio",value:7},{description:"Agosto",value:8},{description:"Septiembre",value:9},{description:"Octubre",value:10},{description:"Noviembre",value:11},{description:"Diciembre",value:12}].slice(0,n)}download(e){return this._http.get(`${x.replace(/\/api(\/|$)/,"")}/uploads/${e}`,{responseType:"blob"})}getAmounts(){return[{description:"Q 800.00",value:800}]}get getToken(){return localStorage.getItem("x-token")||""}get getHeaders(){return{headers:{"x-token":this.getToken}}}listenDialog(){this.onlistenSubject.next()}get dialogStatus(){return this.onlistenSubject.asObservable()}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(nt.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Q=r(7550),g=r(9808),T=r(7322),j=r(7531),U=r(4102),F=r(508),I=r(5245),N=r(7423);function ot(o,a){if(1&o&&(t.TgZ(0,"strong",18),t._uU(1),t.qZA()),2&o){const e=t.oxw(2);t.xp6(1),t.hij("Cliente: ",null==e.user?null:e.user.DisplayName,"")}}function it(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function at(o,a){if(1&o&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.Name)}}function st(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function rt(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function lt(o,a){if(1&o&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.description)}}function ct(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function ut(o,a){if(1&o&&t._UZ(0,"img",20),2&o){const e=t.oxw(2);t.Q6J("src",e.base64Image,t.LSH)}}function mt(o,a){1&o&&(t.TgZ(0,"div",21),t._UZ(1,"mat-icon",22),t.TgZ(2,"div",23),t._uU(3,"PNG"),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("svgIcon","iconsmind:file"))}function dt(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"La im\xe1gen debe ser en extensi\xf3n .jpg, .png o .jpeg"),t.qZA())}function pt(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"La im\xe1gen debe pesar menos o igual a 7mb"),t.qZA())}function gt(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"h1",1),t._uU(2,"Realizar pago"),t.qZA(),t.YNc(3,ot,2,1,"strong",2),t.TgZ(4,"form",3),t.NdJ("ngSubmit",function(){return t.CHM(e),t.oxw().registerPayment()}),t.TgZ(5,"mat-form-field"),t._UZ(6,"input",4),t.YNc(7,it,2,0,"mat-error",0),t.qZA(),t.TgZ(8,"mat-form-field")(9,"mat-select",5),t.NdJ("selectionChange",function(i){return t.CHM(e),t.oxw().onOptionSelection(i)}),t.YNc(10,at,2,2,"mat-option",6),t.qZA(),t.YNc(11,st,2,0,"mat-error",0),t.qZA(),t.TgZ(12,"mat-form-field"),t._UZ(13,"input",7),t.YNc(14,rt,2,0,"mat-error",0),t.qZA(),t.TgZ(15,"mat-form-field")(16,"mat-select",8),t.YNc(17,lt,2,2,"mat-option",6),t.qZA(),t.YNc(18,ct,2,0,"mat-error",0),t.qZA(),t.TgZ(19,"div",9)(20,"div",10),t.YNc(21,ut,1,1,"img",11),t.YNc(22,mt,4,1,"div",12),t.qZA()(),t.TgZ(23,"div",13)(24,"input",14),t.NdJ("change",function(i){return t.CHM(e),t.oxw().onFileSelected(i)}),t.qZA(),t.YNc(25,dt,2,0,"mat-error",0),t.YNc(26,pt,2,0,"mat-error",0),t.qZA(),t.TgZ(27,"div",15)(28,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClose()}),t._uU(29," Cancelar "),t.qZA(),t.TgZ(30,"button",17),t._uU(31," Crear "),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",null==e.data?null:e.data.user),t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("ngIf",e.form.get("description").invalid&&e.form.get("description").touched),t.xp6(3),t.Q6J("ngForOf",e.services),t.xp6(1),t.Q6J("ngIf",e.form.get("serviceId").invalid&&e.form.get("serviceId").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("amount").invalid&&e.form.get("amount").touched),t.xp6(3),t.Q6J("ngForOf",e.months),t.xp6(1),t.Q6J("ngIf",e.form.get("month").invalid&&e.form.get("month").touched),t.xp6(3),t.Q6J("ngIf",e.base64Image),t.xp6(1),t.Q6J("ngIf",!e.base64Image),t.xp6(3),t.Q6J("ngIf",e.invalidExtention),t.xp6(1),t.Q6J("ngIf",e.invalidSize),t.xp6(4),t.Q6J("color","primary")("disabled",e.form.invalid||e.form.pristine&&e.noImageChanged||e.invalidExtention||e.invalidSize)}}function _t(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function ft(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function ht(o,a){if(1&o&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.Q6J("value",e.value),t.xp6(1),t.Oqu(e.description)}}function vt(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function bt(o,a){1&o&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es requerido. "),t.qZA())}function xt(o,a){if(1&o&&t._UZ(0,"img",20),2&o){const e=t.oxw(2);t.Q6J("src",e.base64Image,t.LSH)}}function yt(o,a){1&o&&(t.TgZ(0,"div",21),t._UZ(1,"mat-icon",22),t.TgZ(2,"div",23),t._uU(3,"PNG"),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("svgIcon","iconsmind:file"))}function Ct(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"h2",24),t._uU(2,"Ver detalles del pago"),t.qZA(),t.TgZ(3,"form",25)(4,"mat-form-field"),t._UZ(5,"input",4),t.YNc(6,_t,2,0,"mat-error",0),t.qZA(),t.TgZ(7,"mat-form-field")(8,"input",26),t.NdJ("keypress",function(i){return t.CHM(e),t.oxw().onlyPositiveNumbers(i)}),t.qZA(),t.YNc(9,ft,2,0,"mat-error",0),t.qZA(),t.TgZ(10,"mat-form-field")(11,"mat-select",8),t.YNc(12,ht,2,2,"mat-option",6),t.qZA(),t.YNc(13,vt,2,0,"mat-error",0),t.qZA(),t.TgZ(14,"mat-form-field"),t._UZ(15,"input",27),t.YNc(16,bt,2,0,"mat-error",0),t.qZA(),t.TgZ(17,"div",9)(18,"div",10),t.YNc(19,xt,1,1,"img",11),t.YNc(20,yt,4,1,"div",12),t.qZA()(),t.TgZ(21,"div",15)(22,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClose()}),t._uU(23," Cerrar "),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("ngIf",e.form.get("description").invalid&&e.form.get("description").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("amount").invalid&&e.form.get("amount").touched),t.xp6(3),t.Q6J("ngForOf",e.months),t.xp6(1),t.Q6J("ngIf",e.form.get("month").invalid&&e.form.get("month").touched),t.xp6(3),t.Q6J("ngIf",e.form.get("payedAt").invalid&&e.form.get("payedAt").touched),t.xp6(3),t.Q6J("ngIf",e.base64Image),t.xp6(1),t.Q6J("ngIf",!e.base64Image),t.xp6(2),t.Q6J("color","primary")}}let B=(()=>{class o{constructor(e,n,i,s,l,m,v,A){this.data=e,this._fb=n,this._session=i,this._service=s,this._snackbar=l,this._services=m,this._changeDetectorRef=v,this._dialogRef=A,this.isNew=!0,this.showImage=!1,this.invalidExtention=!1,this.invalidSize=!1,this.months=[],this.amounts=[],this.services=[],this.isPdf=!1,this._unsubscribeAll=new f.x}ngOnInit(){var e;this._onGetSession(),this.getMoths(),this.getAmounts(),this._getServices(),this.initForm(),(null===(e=this.data)||void 0===e?void 0:e.payment)&&this.setForm(this.data.payment)}initForm(){var e,n,i;this.isNew=!0,this.form=this._fb.group({userId:[null===(e=this.user)||void 0===e?void 0:e.id,[c.kI.required]],amount:["",[c.kI.required]],month:["",[c.kI.required]],description:["",[c.kI.required]],payedAt:[""],email:[(null===(n=this.user)||void 0===n?void 0:n.email)||(null===(i=this.user)||void 0===i?void 0:i.Email)],serviceId:["",[c.kI.required]]})}_onGetSession(){var e;(null===(e=this.data)||void 0===e?void 0:e.user)?this.user=this.data.user:this._session.user$.pipe((0,u.R)(this._unsubscribeAll)).subscribe(n=>{this.user=n})}setForm(e){this.isNew=!1,this.noImageChanged=!0,this.form.patchValue({id:e.id,amount:e.amount,userId:null==e?void 0:e.userId,month:parseInt(e.month),description:e.description,payedAt:this.convertDate(e.payedAt)}),(null==e?void 0:e.photo)&&((null==e?void 0:e.photo.includes("pdf"))&&(this.isPdf=!0),this.base64Image=null==e?void 0:e.photo)}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}registerPayment(){if(this.form.invalid)return Object.values(this.form.controls).forEach(e=>e.markAsTouched());this._service.createPayment(this.form.value).subscribe(e=>{if(403==e.statusCode){const n=this.months.find(i=>{var s;return i.value==(null===(s=this.form.controls.month)||void 0===s?void 0:s.value)}).description;return this._snackbar.open(`Ya existe un pago registrado para el mes de ${n}.`)}return 200==e.statusCode?(this.onClose(!0),this._snackbar.open("Se ha registrado el pago exit\xf3samente.")):this._snackbar.open("Ha ocurrido un error al registrar el pago.")})}onFileSelected(e){if(e.target.files&&e.target.files[0]){const i=["image/png","image/jpeg","image/jpg"];if(e.target.files[0].size>2e6)return void(this.invalidSize=!0);if(!i.includes(e.target.files[0].type))return void(this.invalidExtention=!0);const s=new FileReader;s.onload=l=>{this.invalidSize=!1,this.invalidExtention=!1,this.base64Image=l.target.result,this.form.addControl("photo",this._fb.control(this.base64Image)),this.noImageChanged=!1,this._changeDetectorRef.markForCheck()},s.readAsDataURL(e.target.files[0])}}convertDate(e){return(0,b.Mu)(e)}onKeyDown(e){"Space"===e.code&&e.preventDefault()}onlyPositiveNumbers(e){const n=e.target.value+e.key;(isNaN(n)||Number(n)<=0)&&e.preventDefault()}getMoths(){this.months=this._service.getMonths()}getAmounts(){this.amounts=this._service.getAmounts()}onClose(e=!1){this._dialogRef.close(e)}onOptionSelection(e){const n=this.services.find(i=>i.id==e.value);n&&this.form.patchValue({amount:n.Price})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.WI),t.Y36(c.qu),t.Y36(D.K),t.Y36(w),t.Y36(b.cw),t.Y36(Q.r),t.Y36(t.sBO),t.Y36(h.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-dialog"]],decls:2,vars:2,consts:[[4,"ngIf"],["mat-dialog-title","",1,"mat-dialog-payment-title"],["mat-dialog-title","","class","mat-dialog-payment-subtitle",4,"ngIf"],["name","form",3,"formGroup","ngSubmit"],["matInput","","placeholder","Detalles del pago","formControlName","description"],["placeholder","Servicio","formControlName","serviceId",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","","placeholder","Monto","formControlName","amount"],["placeholder","Mes","formControlName","month"],[1,"aspect-w-9","aspect-h-6","mt-4"],[1,"flex","items-center","justify-center","border","rounded-lg","bg-gray-50","dark:bg-card"],["class","donation-image",3,"src",4,"ngIf"],["class","relative",4,"ngIf"],[1,"mt-4"],["type","file","name","image","accept",".jpeg,.jpg,.png",3,"change"],["mat-dialog-actions",""],["mat-button","","type","button",3,"click"],["mat-flat-button","","type","submit",3,"color","disabled"],["mat-dialog-title","",1,"mat-dialog-payment-subtitle"],[3,"value"],[1,"donation-image",3,"src"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"bg-red-600","doc-file"],["mat-dialog-title",""],["name","form",3,"formGroup"],["matInput","","placeholder","Monto","formControlName","amount",3,"keypress"],["matInput","","placeholder","Fecha de pago efectuado","formControlName","payedAt"],["mat-flat-button","",3,"color","click"]],template:function(e,n){1&e&&(t.YNc(0,gt,32,14,"ng-container",0),t.YNc(1,Ct,24,9,"ng-container",0)),2&e&&(t.Q6J("ngIf",n.isNew),t.xp6(1),t.Q6J("ngIf",!n.isNew))},directives:[g.O5,h.uh,c._Y,c.JL,c.sg,T.KE,j.Nt,c.Fj,c.JJ,c.u,T.TO,U.gD,g.sg,F.ey,I.Hw,h.H8,N.lW],styles:[".mat-form-field[_ngcontent-%COMP%]{display:grid!important;width:100%;margin-bottom:10px}.donation-image[_ngcontent-%COMP%]{height:100%;object-fit:cover}.doc-file[_ngcontent-%COMP%]{color:#fff;font-weight:700;text-align:center;font-style:italic}.mat-dialog-payment-title[_ngcontent-%COMP%]{margin:0!important}.mat-dialog-payment-subtitle[_ngcontent-%COMP%]{font-size:15px;color:gray!important}"]}),o})();var p=r(574),Zt=r(4557);const Tt=["searchSelectInput"];function It(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){return t.CHM(e),t.oxw().onClearFilter()}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA()()}}let At=(()=>{class o{constructor(){this.placeholderLabel="Buscar",this._unsubscribe=new f.x,this.searchInputFormControl=new c.NI(""),this.searchValueOutput=new t.vpe}ngOnInit(){this._onListenInput()}ngOnDestroy(){this._unsubscribe.next(!1),this._unsubscribe.complete()}handleKeyDown(e){e.stopPropagation()}onClearFilter(){this.searchInputFormControl.setValue(""),this.searchSelectInput.nativeElement.focus()}_onListenInput(){this.searchInputFormControl.valueChanges.pipe((0,u.R)(this._unsubscribe)).subscribe(e=>this.searchValueOutput.emit(e))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["select-filter"]],viewQuery:function(e,n){if(1&e&&t.Gf(Tt,7,t.SBq),2&e){let i;t.iGM(i=t.CRH())&&(n.searchSelectInput=i.first)}},inputs:{placeholderLabel:"placeholderLabel"},outputs:{searchValueOutput:"searchValueOutput"},decls:3,vars:3,consts:[["matInput","","autocomplete","off",3,"placeholder","formControl","keydown"],["searchSelectInput",""],["mat-button","","mat-icon-button","","aria-label","Limpiar filtro",3,"click",4,"ngIf"],["mat-button","","mat-icon-button","","aria-label","Limpiar filtro",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"input",0,1),t.NdJ("keydown",function(s){return n.handleKeyDown(s)}),t.qZA(),t.YNc(2,It,3,0,"button",2)),2&e&&(t.Q6J("placeholder",n.placeholderLabel)("formControl",n.searchInputFormControl),t.xp6(2),t.Q6J("ngIf",null==n.searchInputFormControl?null:n.searchInputFormControl.value))},directives:[c.Fj,c.JJ,c.oH,g.O5,I.Hw],styles:["[_nghost-%COMP%]{width:100%;display:flex;padding:12px 16px;position:relative;flex-direction:row;align-items:center;justify-content:flex-start;border-bottom:1px solid #ebebeb}"]}),o})();var P=r(5861),k=r(6087),Y=r(4847),Nt=r(3844),Pt=r(3905),St=r(1683),G=r(7238);function Jt(o,a){if(1&o&&t._UZ(0,"img",21),2&o){const e=t.oxw().$implicit;t.Q6J("src",null==e?null:e.photo,t.LSH)}}function Dt(o,a){1&o&&(t.TgZ(0,"div",22),t._uU(1," NO THUMB "),t.qZA())}function wt(o,a){1&o&&t._UZ(0,"mat-icon",23),2&o&&t.Q6J("matTooltip","Pendiente de revisi\xf3n")}function Qt(o,a){1&o&&t._UZ(0,"mat-icon",24),2&o&&t.Q6J("matTooltip","Aprobado")}function Ut(o,a){1&o&&t._UZ(0,"mat-icon",25),2&o&&t.Q6J("matTooltip","Rechazado")}function Ft(o,a){1&o&&t._UZ(0,"mat-icon",26),2&o&&t.Q6J("matTooltip","Anulado")}function kt(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).approve(i)}),t._UZ(1,"mat-icon",28),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("matTooltip","Aprobar pago")("disabled",2===(null==e?null:e.state)||3===(null==e?null:e.state)||4===(null==e?null:e.state))}}function Yt(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).deny(i)}),t._UZ(1,"mat-icon",29),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("matTooltip","Denegar pago")("disabled",2===(null==e?null:e.state)||3===(null==e?null:e.state)||4===(null==e?null:e.state))}}function Mt(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).cancel(i)}),t._UZ(1,"mat-icon",30),t.qZA()}if(2&o){const e=t.oxw().$implicit;t.Q6J("matTooltip","Anular pago")("disabled",(null==e?null:e.state)<=1||(null==e?null:e.state)>=4)}}function Ot(o,a){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"div",7)(3,"div",8),t.YNc(4,Jt,1,1,"img",9),t.YNc(5,Dt,2,0,"div",10),t.qZA()(),t.TgZ(6,"div",11),t._uU(7),t.qZA(),t.TgZ(8,"div",11),t._uU(9),t.ALo(10,"currency"),t.qZA(),t.TgZ(11,"div",11),t._uU(12),t.qZA(),t.TgZ(13,"div",11),t._uU(14),t.qZA(),t.TgZ(15,"div",11),t.YNc(16,wt,1,1,"mat-icon",12),t.YNc(17,Qt,1,1,"mat-icon",13),t.YNc(18,Ut,1,1,"mat-icon",14),t.YNc(19,Ft,1,1,"mat-icon",15),t.qZA(),t.TgZ(20,"div")(21,"button",16),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(3).openDialog(s)}),t._UZ(22,"mat-icon",17),t.qZA(),t.YNc(23,kt,2,2,"button",18),t.YNc(24,Yt,2,2,"button",18),t.YNc(25,Mt,2,2,"button",18),t.TgZ(26,"button",19),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(3).downloadRecipe(null==s?null:s.recipe)}),t._UZ(27,"mat-icon",20),t.qZA()()(),t.BQk()}if(2&o){const e=a.$implicit,n=t.oxw(3);t.xp6(4),t.Q6J("ngIf",null==e?null:e.photo),t.xp6(1),t.Q6J("ngIf",!(null!=e&&e.photo)),t.xp6(2),t.hij(" ",n.translateService(null==e?null:e.serviceId)," "),t.xp6(2),t.hij(" ",t.gM2(10,15,null==e?null:e.amount,"GTQ","symbol","1.2-2")," "),t.xp6(3),t.hij(" ",n.convertMonth(null==e?null:e.month)," "),t.xp6(2),t.hij(" ",n.convertDate(null==e?null:e.payedAt)," "),t.xp6(2),t.Q6J("ngIf",1===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",2===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",3===(null==e?null:e.state)),t.xp6(1),t.Q6J("ngIf",4===(null==e?null:e.state)),t.xp6(4),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("disabled",2!==(null==e?null:e.state))("matTooltip","Descargar comprobante")}}function Lt(o,a){if(1&o&&(t.ynx(0),t.YNc(1,Ot,28,20,"ng-container",5),t.BQk()),2&o){const e=a.ngIf,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e)("ngForTrackBy",n.trackByFn)}}const qt=function(o){return{"pointer-events-none":o}};function Rt(o,a){if(1&o&&(t.ynx(0),t.TgZ(1,"div",1)(2,"div",2),t._UZ(3,"div",3),t.TgZ(4,"div"),t._uU(5,"Servicio"),t.qZA(),t.TgZ(6,"div"),t._uU(7,"Monto"),t.qZA(),t.TgZ(8,"div"),t._uU(9,"Mes"),t.qZA(),t.TgZ(10,"div"),t._uU(11,"Fecha de pago"),t.qZA(),t.TgZ(12,"div"),t._uU(13,"Estado"),t.qZA(),t.TgZ(14,"div"),t._uU(15,"Opciones"),t.qZA()(),t.YNc(16,Lt,2,2,"ng-container",0),t.ALo(17,"async"),t.qZA(),t._UZ(18,"mat-paginator",4),t.BQk()),2&o){const e=t.oxw();t.xp6(16),t.Q6J("ngIf",t.lcZ(17,4,e.payments$)),t.xp6(2),t.Q6J("ngClass",t.VKq(6,qt,e.loading))("length",e.count)("pageSizeOptions",e.pageSizeOptions)}}function Ht(o,a){1&o&&(t.ynx(0),t.TgZ(1,"div",31),t._UZ(2,"mat-icon",32),t.TgZ(3,"div",33),t._uU(4," No se han encontrado pagos realizados. "),t.qZA()(),t.BQk()),2&o&&(t.xp6(2),t.Q6J("svgIcon","heroicons_outline:document"))}let Et=(()=>{class o{constructor(e,n,i,s,l,m,v){this.dialog=e,this._user=n,this._payment=i,this._snackbar=s,this._services=l,this._changeDetectorRef=m,this._fuseConfirmationService=v,this._unsubscribeAll=new f.x,this.payments=[],this.pageSize=10,this.page=1,this.count=0,this.pages=0,this.pageSizeOptions=[10,15,25],this.services=[]}ngOnInit(){this._onGetSession(),this._getServices(),this.onListenDialog(),this.onChangeNeighbors(),this.getPayments()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}getPayments(e,n=1,i=10){var s;try{const l=e||parseInt(null===(s=this.user)||void 0===s?void 0:s.id);this.loading=!0,this._payment.getPayments({page:n,pageSize:i,userId:l}).pipe((0,u.R)(this._unsubscribeAll)).subscribe(m=>{this.payments=m.payments,this.page=m.page,this.count=m.total,this.pages=m.pages,this.loading=!1,this._changeDetectorRef.markForCheck()}),this.payments$=this._payment.payments$}catch(l){console.log(l)}}_onGetSession(){this._user.user$.pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.user=e})}onListenDialog(){this._payment.dialogStatus.pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.getPayments(this.userId,this.page,this.pageSize)})}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}approve(e){var n=this;return(0,P.Z)(function*(){"confirmed"==(yield n._onConfirm({icon:{color:"primary",name:"heroicons_outline:shield-check"},title:"Aprobar pago",message:"\xbfEst\xe1 seguro en aprobar el pago?",actions:{confirm:{label:"Aprobar",color:"primary"},cancel:{label:"Cancelar"}}}))&&n._payment.approvePayment({paymentId:e.id,userId:e.userId}).pipe((0,u.R)(n._unsubscribeAll)).subscribe(s=>{n._snackbar.open(200!=(null==s?void 0:s.statusCode)?"Ha ocurrido un error al aprobar el pago.":"Se ha aprobado el pago de manera exit\xf3sa."),200==s.statusCode&&n.getPayments(n.userId,n.page,n.pageSize)})})()}deny(e){var n=this;return(0,P.Z)(function*(){"confirmed"==(yield n._onConfirm({icon:{color:"error",name:"heroicons_outline:x"},title:"Denegar pago",message:"\xbfEst\xe1 seguro en denegar el pago?",actions:{confirm:{label:"Denegar",color:"primary"},cancel:{label:"Cancelar"}}}))&&n._payment.denyPayment({paymentId:e.id,userId:e.userId}).pipe((0,u.R)(n._unsubscribeAll)).subscribe(s=>{n._snackbar.open(200!=(null==s?void 0:s.statusCode)?"Ha ocurrido un error al denegar el pago.":"Se ha denegado el pago de manera exit\xf3sa."),200==s.statusCode&&n.getPayments(n.userId,n.page,n.pageSize)})})()}cancel(e){var n=this;return(0,P.Z)(function*(){"confirmed"==(yield n._onConfirm({icon:{color:"warning",name:"heroicons_outline:reply"},title:"Anular pago",message:"\xbfEst\xe1 seguro en anular el pago?",actions:{confirm:{label:"Anular",color:"primary"},cancel:{label:"Cancelar"}}}))&&n._payment.cancelPayment({paymentId:e.id,userId:e.userId}).pipe((0,u.R)(n._unsubscribeAll)).subscribe(s=>{n._snackbar.open(200!=(null==s?void 0:s.statusCode)?"Ha ocurrido un error al anular el pago.":"Se ha anulado el pago de manera exit\xf3sa."),200==s.statusCode&&n.getPayments(n.userId,n.page,n.pageSize)})})()}onChangeNeighbors(){this._payment.userId$.pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.userId=e,this.getPayments(e)})}convertDate(e){return(0,b.Mu)(e)}convertMonth(e){var n;return null===(n=this._payment.getMonths().find(s=>s.value==e))||void 0===n?void 0:n.description}openDialog(e){this.dialog.open(B,{width:"500px",maxHeight:"650px",data:{payment:e}})}translateService(e){var n;return(null===(n=this.services.find(i=>i.id===e))||void 0===n?void 0:n.Name)||""}downloadRecipe(e){this._payment.download(e).pipe((0,u.R)(this._unsubscribeAll)).subscribe(n=>{const i=null==e?void 0:e.replace(/.*_/,""),s=new Blob([n],{type:"application/pdf"}),l=window.URL.createObjectURL(s),m=document.createElement("a");m.href=l,m.download=i,m.click(),window.URL.revokeObjectURL(l)})}_onConfirm(e){var n=this;return(0,P.Z)(function*(){try{const i=n._fuseConfirmationService.open(e);return yield(0,Pt.z)(i.afterClosed().pipe((0,u.R)(n._unsubscribeAll)))}catch(i){return"cancelled"}})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.uw),t.Y36(D.K),t.Y36(w),t.Y36(b.cw),t.Y36(Q.r),t.Y36(t.sBO),t.Y36(St.R))},o.\u0275cmp=t.Xpm({type:o,selectors:[["payment-list"]],viewQuery:function(e,n){if(1&e&&(t.Gf(k.NW,5),t.Gf(Y.YE,5)),2&e){let i;t.iGM(i=t.CRH())&&(n._paginator=i.first),t.iGM(i=t.CRH())&&(n._sort=i.first)}},decls:2,vars:2,consts:[[4,"ngIf"],[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-grid-payment","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"hidden","sm:block"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageSizeOptions"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-grid-payment","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b"],[1,"flex","items-center"],[1,"relative","flex","flex-0","items-center","justify-center","w-12","h-12","mr-6","rounded","overflow-hidden","border"],["class","donation-photo-list",3,"src",4,"ngIf"],["class","flex items-center justify-center w-full h-full text-xs font-semibold leading-none text-center uppercase",4,"ngIf"],[1,"truncate"],["style","color: rgb(3, 159, 187)","svgIcon","heroicons_outline:information-circle",3,"matTooltip",4,"ngIf"],["style","color: green","svgIcon","heroicons_outline:check-circle",3,"matTooltip",4,"ngIf"],["style","color: red","svgIcon","heroicons_outline:x-circle",3,"matTooltip",4,"ngIf"],["style","color: rgb(255, 145, 0)","svgIcon","heroicons_outline:minus-circle",3,"matTooltip",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6",3,"click"],["svgIcon","heroicons_outline:pencil-alt"],["mat-stroked-button","","class","min-w-10 min-h-7 h-7 px-2 leading-6 ml-2",3,"matTooltip","disabled","click",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"disabled","matTooltip","click"],["svgIcon","heroicons_outline:save"],[1,"donation-photo-list",3,"src"],[1,"flex","items-center","justify-center","w-full","h-full","text-xs","font-semibold","leading-none","text-center","uppercase"],["svgIcon","heroicons_outline:information-circle",2,"color","rgb(3, 159, 187)",3,"matTooltip"],["svgIcon","heroicons_outline:check-circle",2,"color","green",3,"matTooltip"],["svgIcon","heroicons_outline:x-circle",2,"color","red",3,"matTooltip"],["svgIcon","heroicons_outline:minus-circle",2,"color","rgb(255, 145, 0)",3,"matTooltip"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"matTooltip","disabled","click"],["svgIcon","heroicons_outline:check"],["svgIcon","heroicons_outline:x"],["svgIcon","heroicons_outline:reply"],[1,"flex","flex-col","flex-auto","items-center","justify-center",2,"margin-top","17%"],[1,"icon-size-24",3,"svgIcon"],[1,"mt-4","text-2xl","font-semibold","tracking-tight","text-secondary"]],template:function(e,n){1&e&&(t.YNc(0,Rt,19,8,"ng-container",0),t.YNc(1,Ht,5,1,"ng-container",0)),2&e&&(t.Q6J("ngIf",n.count),t.xp6(1),t.Q6J("ngIf",!n.count&&!n.loading))},directives:[g.O5,Y.YE,g.sg,I.Hw,G.gM,N.lW,k.NW,g.mk],pipes:[g.Ov,g.H9],styles:[".inventory-grid-payment{grid-template-columns:3.5fr 1.5fr 1fr}@media (min-width: 600px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}@media (min-width: 960px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}@media (min-width: 1280px){.inventory-grid-payment{grid-template-columns:.5fr 1fr 1fr 1fr 1fr 1fr 2fr}}.donation-photo-list{height:100%;width:100%}\n"],encapsulation:2,data:{animation:Nt.L},changeDetection:0}),o})();function $t(o,a){1&o&&(t.TgZ(0,"mat-option",25),t._uU(1," No existen resultados "),t.qZA())}function zt(o,a){if(1&o&&(t.TgZ(0,"mat-option",26),t._uU(1),t.qZA()),2&o){const e=a.$implicit;t.Q6J("value",e.id),t.xp6(1),t.Oqu(e.DisplayName)}}function jt(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"mat-form-field",17),t._UZ(1,"mat-icon",18),t.TgZ(2,"mat-select",19,20),t.NdJ("selectionChange",function(i){return t.CHM(e),t.oxw().onOptionSelection(i)})("openedChange",function(){return t.CHM(e),t.MAs(5).onClearFilter()}),t.TgZ(4,"select-filter",21,22),t.NdJ("searchValueOutput",function(i){return t.CHM(e),t.oxw().onFilterNeighbors(i)}),t.qZA(),t.YNc(6,$t,2,0,"mat-option",23),t.YNc(7,zt,2,2,"mat-option",24),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("svgIcon","heroicons_solid:search"),t.xp6(1),t.Q6J("formControl",e.searchInputControl),t.xp6(4),t.Q6J("ngIf",!(e.isLoadingNeighbors||null!=e.neighbors&&e.neighbors.length)),t.xp6(1),t.Q6J("ngForOf",e.neighbors)}}const Bt=[{path:"",component:(()=>{class o{constructor(e,n,i,s,l,m){this._user=e,this._dialog=n,this._session=i,this._payments=s,this._snackbar=l,this._services=m,this.services=[],this.payments=[],this._search=new f.x,this.isLoadingNeighbors=!1,this._unsubscribeAll=new f.x,this.searchInputControl=new c.NI}ngOnInit(){this.onValidateRole(),this._onChangeSelection(),this._getServices()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}onValidateRole(){this._session.user$.pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.user=e,1===(null==e?void 0:e.role)&&this._onFilterNeighbors()})}onExportData(){var e,n,i,s,l,m,v,A,M,O,L,q,R,H;if(!this.payments.length)return this._snackbar.open("No existen datos para este usuario a exportar.");const ne=null===(e=this.payments)||void 0===e?void 0:e.map(J=>{var d=(0,K._T)(J,["id","userId","photo"]);return{Monto:null==d?void 0:d.amount,Descripcion:null==d?void 0:d.description,Fecha:this._convertDate(null==d?void 0:d.payedAt),Mes:this._convertMonth(parseInt(null==d?void 0:d.month)),Servicio:this._translateService(null==d?void 0:d.serviceId),Estado:this._translateState(null==d?void 0:d.state)}}),oe=null===(n=this.payments)||void 0===n?void 0:n.reduce((J,E)=>J+((2==E.state?E.amount:0)||0),0),S=(null===(i=this.optionSelected)||void 0===i?void 0:i.DisplayName)?null===(l=this.optionSelected)||void 0===l?void 0:l.DisplayName:null===(s=this.user)||void 0===s?void 0:s.name,ie=(null===(m=this.optionSelected)||void 0===m?void 0:m.Dpi)?null===(A=this.optionSelected)||void 0===A?void 0:A.Dpi:null===(v=this.user)||void 0===v?void 0:v.dpi,ae=(null===(M=this.optionSelected)||void 0===M?void 0:M.Direccion)?null===(L=this.optionSelected)||void 0===L?void 0:L.Direccion:null===(O=this.user)||void 0===O?void 0:O.direccion,se=(null===(q=this.optionSelected)||void 0===q?void 0:q.Telefono)?null===(H=this.optionSelected)||void 0===H?void 0:H.Telefono:null===(R=this.user)||void 0===R?void 0:R.telefono,re=`${null==S?void 0:S.replace(" ","_")}_${this._getHexadecimalDate()}.xlsx`,_=p.P6.aoa_to_sheet([]);p.P6.sheet_add_aoa(_,[["Usuario: "+S]],{origin:"A1"}),p.P6.sheet_add_aoa(_,[["Documento Personal de Identificaci\xf3n : "+ie]],{origin:"A2"}),p.P6.sheet_add_aoa(_,[["Direcci\xf3n: "+ae]],{origin:"A3"}),p.P6.sheet_add_aoa(_,[["Telefono: "+se]],{origin:"A4"}),p.P6.sheet_add_aoa(_,[["Subotal (Aprobados y pendientes): Q"+oe]],{origin:"A5"}),p.P6.sheet_add_aoa(_,[[]],{origin:-1}),p.P6.sheet_add_json(_,ne,{origin:-1});const V=p.P6.book_new();p.P6.book_append_sheet(V,_,"COCODE CUILCO"),p.NC(V,re)}onOptionSelection(e){this.optionSelected=this.neighbors.find(n=>n.id==e.value),this._payments.userId.next(e.value)}openDialog(){this._dialog.open(B,{width:"500px",maxHeight:"650px",data:{user:this.optionSelected}}).afterClosed().pipe((0,u.R)(this._unsubscribeAll)).subscribe(n=>this._payments.listenDialog())}onFilterNeighbors(e){!e||(this.isLoadingNeighbors=!0,this._search.next(e))}_onChangeSelection(){this._payments.payments$.pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.payments=e})}_getServices(){this._services.findServices({page:1,pageSize:100}).pipe((0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.services=null==e?void 0:e.services}),this.services$=this._services.services$}_convertDate(e){return(0,b.Mu)(e)}_convertMonth(e){var n;return null===(n=this._payments.getMonths().find(s=>s.value==e))||void 0===n?void 0:n.description}_translateService(e){var n;return(null===(n=this.services.find(i=>i.id===e))||void 0===n?void 0:n.Name)||""}_translateState(e){switch(e){case 2:return"Aprobado";case 3:return"Rechazado";case 4:return"Anulado";default:return"Pendiente"}}_getHexadecimalDate(){return Date.now().toString(16)}_onFilterNeighbors(){1===this.user.role&&this._search.pipe((0,X.b)(500),(0,W.w)(e=>this._user.getUsersAsync(e)),(0,u.R)(this._unsubscribeAll)).subscribe(e=>{this.neighbors=e},e=>{this.neighbors=[]},()=>{this.isLoadingNeighbors=!1})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Zt.K),t.Y36(h.uw),t.Y36(D.K),t.Y36(w),t.Y36(b.cw),t.Y36(Q.r))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-payment"]],decls:22,vars:4,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["class","fuse-mat-dense fuse-mat-no-subscript fuse-mat-rounded min-w-64",4,"ngIf"],["mat-flat-button","",1,"ml-4","mr-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-wrap","ml-2","mt-2"],[1,"flex","flex-col","w-18","h-18","m-2","p-4","rounded-2xl","cursor-pointer","bg-card",3,"click"],[1,"aspect-w-9","aspect-h-6"],[1,"flex","items-center","justify-center"],[1,"relative"],[1,"icon-size-14","text-hint",3,"svgIcon"],[1,"absolute","left-0","bottom-0","px-1.5","rounded","text-sm","font-semibold","leading-5","text-white","bg-green-600"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"],[1,"fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","selectionChange","openedChange"],["residenceSelect",""],["placeholderLabel","Buscar...",3,"searchValueOutput"],["neighborsFilterControl",""],["disabled","",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["disabled",""],[3,"value"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Pagos"),t.qZA(),t.TgZ(4,"div",3),t.YNc(5,jt,8,4,"mat-form-field",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return n.openDialog()}),t._UZ(7,"mat-icon",6),t.TgZ(8,"span",7),t._uU(9,"Realizar pago"),t.qZA()(),t.TgZ(10,"div",8),t.ynx(11),t.TgZ(12,"a",9),t.NdJ("click",function(){return n.onExportData()}),t.TgZ(13,"div",10)(14,"div",11)(15,"div",12),t._UZ(16,"mat-icon",13),t.TgZ(17,"div",14),t._uU(18," XLSX "),t.qZA()()()()(),t.BQk(),t.qZA()()(),t.TgZ(19,"div",15)(20,"div",16),t._UZ(21,"payment-list"),t.qZA()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",1===(null==n.user?null:n.user.role)),t.xp6(1),t.Q6J("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:plus"),t.xp6(9),t.Q6J("svgIcon","iconsmind:file"))},directives:[g.O5,T.KE,I.Hw,T.qo,U.gD,c.JJ,c.oH,At,F.ey,g.sg,N.lW,Et],encapsulation:2}),o})()}];let Gt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[z.Bz.forChild(Bt)],z.Bz]}),o})();var Vt=r(4466),Kt=r(7446),Xt=r(2181),Wt=r(5899),te=r(2368);let ee=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[Vt.m,Gt,N.ot,Kt.p9,T.lN,I.Ps,j.c,Xt.Tx,k.TU,Wt.Cv,F.si,Y.JX,U.LD,te.rP,G.AV,h.Is]]}),o})()}}]);